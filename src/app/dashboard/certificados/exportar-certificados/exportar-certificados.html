<div class="p-8 space-y-8">
    <div class="flex justify-between items-center">
        <h2 class="text-3xl font-black text-slate-800 italic underline decoration-blue-500/30">Panel de Certificados</h2>
        
        <button 
            (click)="exportarCSV()" 
            [disabled]="autorizadosFiltrados.length === 0" 
            class="bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 text-white px-6 py-3 rounded-xl font-bold transition shadow-lg flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            Exportar Vista Actual (CSV)
        </button>
    </div>

    <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50 flex items-center gap-4">
            <label class="text-sm font-bold text-slate-700">Filtrar por Curso:</label>
            <select 
                [(ngModel)]="cursoSeleccionadoId" 
                (change)="onCursoChange()" 
                class="border border-slate-300 rounded-lg px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500 bg-white min-w-[300px]">
                <option value="">-- Ver todos los estudiantes autorizados --</option>
                <option *ngFor="let curso of cursos" [value]="curso.id">
                    {{ curso.titulo }}
                </option>
            </select>
            <span class="text-xs text-slate-400 font-medium ml-auto">
                {{ autorizadosFiltrados.length }} registros encontrados
            </span>
        </div>

        <div class="p-0">
            <div *ngIf="cargando" class="text-center py-20">
                <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600 mx-auto"></div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-left border-separate border-spacing-0">
                    <thead>
                        <tr class="bg-slate-100 text-slate-600 text-[11px] uppercase tracking-wider font-bold">
                            <th class="px-6 py-4 border-b">Nombre</th>
                            <th class="px-6 py-4 border-b">Correo</th>
                            <th class="px-6 py-4 border-b">Curso</th>
                            <th class="px-6 py-4 border-b text-center">Fecha Autorizaci√≥n</th>
                            <th class="px-6 py-4 border-b">Autorizado Por</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        <tr *ngFor="let a of autorizadosFiltrados" class="hover:bg-slate-50 transition text-sm">
                            <td class="px-6 py-4 font-medium text-slate-800">
                                {{ a.estudiante_nombre || a.estudiante?.nombre_completo || 'N/A' }}
                            </td>
                            
                            <td class="px-6 py-4 text-slate-500">
                                {{ a.estudiante_correo || a.estudiante?.correo || 'N/A' }}
                            </td>
                            
                            <td class="px-6 py-4">
                                <span class="bg-indigo-50 text-indigo-700 px-2 py-1 rounded text-xs font-semibold">
                                    {{ a.curso_nombre || a.evaluacion?.curso?.titulo || 'Curso' }}
                                </span>
                            </td>
                            
                            <td class="px-6 py-4 text-slate-500 text-center">
                                {{ (a.fecha_autorizacion || a.fecha_fin) | date:'dd/MM/yyyy' }}
                            </td>
                            
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full" [ngClass]="a.profesor_nombre ? 'bg-green-500' : 'bg-slate-300'"></span>
                                    <span class="text-slate-700">
                                        {{ a.profesor_nombre || 'N/A' }}
                                    </span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div *ngIf="!cargando && autorizadosFiltrados.length === 0" class="p-20 text-center text-slate-500">
                No hay estudiantes autorizados para mostrar.
            </div>
        </div>
    </section>
</div>